<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Parallel PopGen Package: src/3P/_internal/rng.cuh Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Parallel PopGen Package
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('rng_8cuh_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">rng.cuh</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * rng.cuh</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *      Author: David Lawrie</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      for RNG functions</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#ifndef RNG_CUH_</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#define RNG_CUH_</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;cuda_runtime.h&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;../_outside_libraries/helper_math.h&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;limits.h&gt;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;../_outside_libraries/Random123/philox.h&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;../_outside_libraries/Random123/features/compilerfeatures.h&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/* ----- random number generation ----- */</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_r_n_g.html">RNG</a>{</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;constexpr <span class="keywordtype">int</span> RNG_MEAN_BOUNDARY_NORM = 6;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;constexpr <span class="keywordtype">int</span> RNG_N_BOUNDARY_POIS_BINOM = 100;  <span class="comment">//binomial calculation starts to become numerically unstable for large values of N, not sure where that starts but is between 200 and 200,000</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// uint_float_01: Input is a W-bit integer (unsigned).  It is multiplied</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">// by Float(2^-W) and added to Float(2^(-W-1)).  A good compiler should</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// optimize it down to an int-to-float conversion followed by a multiply</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// and an add, which might be fused, depending on the architecture.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">// If the input is a uniformly distributed integer, then the</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">// result is a uniformly distributed floating point number in [0, 1].</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">// The result is never exactly 0.0.</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">// The smallest value returned is 2^-W.</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">// Let M be the number of mantissa bits in Float.</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// If W&gt;M  then the largest value retured is 1.0.</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">// If W&lt;=M then the largest value returned is the largest Float less than 1.0.</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;__host__ __device__ __forceinline__ <span class="keywordtype">float</span> uint_float_01(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> in){</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">//(mostly) stolen from Philox code &quot;uniform.hpp&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    R123_CONSTEXPR <span class="keywordtype">float</span> factor = float(1.)/(UINT_MAX + float(1.));</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    R123_CONSTEXPR <span class="keywordtype">float</span> halffactor = float(0.5)*factor;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">return</span> in*factor + halffactor;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;__host__ __device__ __forceinline__  uint4 Philox(int2 seed, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> step, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> population, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> round){</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keyword">typedef</span> r123::Philox4x32_R&lt;10&gt; P; <span class="comment">//can change the 10 rounds of bijection down to 7 (lowest safe limit) to get possible extra speed!</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    P rng;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seedx = seed.x;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seedy = seed.y;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    P::key_type key = {{seedx, seedy}}; <span class="comment">//random int to set key space + seed</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    P::ctr_type count = {{k, step, population, round}};</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keyword">union </span>{</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        P::ctr_type c;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        uint4 i;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }u;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    u.c = rng(count, key);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">return</span> u.i;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;__host__ __device__ __forceinline__ <span class="keywordtype">void</span> binom_iter(<span class="keywordtype">float</span> j, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> n, <span class="keywordtype">float</span> &amp; emu, <span class="keywordtype">float</span> &amp; cdf){</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    emu *= ((n+1.f-j)*x)/(j*(1-x));</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    cdf += emu;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;}</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;__host__ __device__ __forceinline__ <span class="keywordtype">int</span> binomcdfinv(<span class="keywordtype">float</span> r, <span class="keywordtype">float</span> mean, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> n){</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">float</span> emu = powf(1-x,n);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">if</span>(emu == 1) { emu = expf(-1 * mean);  }</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordtype">float</span> cdf = emu;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 0; }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    binom_iter(1.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 1; }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    binom_iter(2.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 2; }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    binom_iter(3.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 3; }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    binom_iter(4.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 4; }</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    binom_iter(5.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 5; }</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    binom_iter(6.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 6; }</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    binom_iter(7.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 7; }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    binom_iter(8.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 8; }</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    binom_iter(9.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 9; }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    binom_iter(10.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 10; }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    binom_iter(11.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 1){ <span class="keywordflow">return</span> 11; }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    binom_iter(12.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 12; }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    binom_iter(13.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 13; }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    binom_iter(14.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 2){ <span class="keywordflow">return</span> 14; }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    binom_iter(15.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 15; }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    binom_iter(16.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 16; }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    binom_iter(17.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 3){ <span class="keywordflow">return</span> 17; }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    binom_iter(18.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 18; }</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    binom_iter(19.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 19; }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    binom_iter(20.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 4){ <span class="keywordflow">return</span> 20; }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    binom_iter(21.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 21; }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    binom_iter(22.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 5){ <span class="keywordflow">return</span> 22; }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    binom_iter(23.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 23; }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    binom_iter(24.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 6){ <span class="keywordflow">return</span> 24; }</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    binom_iter(25.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 25; }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    binom_iter(26.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 7){ <span class="keywordflow">return</span> 26; }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    binom_iter(27.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 27; }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    binom_iter(28.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 8){ <span class="keywordflow">return</span> 28; }</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    binom_iter(29.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 29; }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    binom_iter(30.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 9){ <span class="keywordflow">return</span> 30; }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    binom_iter(31.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 31; }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    binom_iter(32.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 10){ <span class="keywordflow">return</span> 32; }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    binom_iter(33.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 33; }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    binom_iter(34.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 11){ <span class="keywordflow">return</span> 34; }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    binom_iter(35.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 35; }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    binom_iter(36.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 12){ <span class="keywordflow">return</span> 36; }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    binom_iter(37.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 37; }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    binom_iter(38.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 13){ <span class="keywordflow">return</span> 38; }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    binom_iter(39.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 39; }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    binom_iter(40.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 14){ <span class="keywordflow">return</span> 40; }</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    binom_iter(41.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 15){ <span class="keywordflow">return</span> 41; }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    binom_iter(42.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 42; }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    binom_iter(43.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 16){ <span class="keywordflow">return</span> 43; }</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    binom_iter(44.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 44; }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    binom_iter(45.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 17){ <span class="keywordflow">return</span> 45; }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    binom_iter(46.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 18){ <span class="keywordflow">return</span> 46; }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    binom_iter(47.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 47; }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    binom_iter(48.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 19){ <span class="keywordflow">return</span> 48; }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    binom_iter(49.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 49; }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    binom_iter(50.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 20){ <span class="keywordflow">return</span> 50; }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    binom_iter(51.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 21){ <span class="keywordflow">return</span> 51; }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    binom_iter(52.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 52; }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    binom_iter(53.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 22){ <span class="keywordflow">return</span> 53; }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    binom_iter(54.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 54; }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    binom_iter(55.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 23){ <span class="keywordflow">return</span> 55; }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    binom_iter(56.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 24){ <span class="keywordflow">return</span> 56; }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    binom_iter(57.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 57; }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    binom_iter(58.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 25){ <span class="keywordflow">return</span> 58; }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    binom_iter(59.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 26){ <span class="keywordflow">return</span> 59; }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    binom_iter(60.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 60; }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    binom_iter(61.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 27){ <span class="keywordflow">return</span> 61; }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    binom_iter(62.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 28){ <span class="keywordflow">return</span> 62; }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    binom_iter(63.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 63; }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    binom_iter(64.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 29){ <span class="keywordflow">return</span> 64; }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    binom_iter(65.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 30){ <span class="keywordflow">return</span> 65; }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    binom_iter(66.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 66; }</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    binom_iter(67.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 31){ <span class="keywordflow">return</span> 67; }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    binom_iter(68.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 32){ <span class="keywordflow">return</span> 68; }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    binom_iter(69.f, x, n, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 69; }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">return</span> 70; <span class="comment">//17 for mean &lt;= 3, 24 limit for mean &lt;= 6, 32 limit for mean &lt;= 10, 36 limit for mean &lt;= 12, 41 limit for mean &lt;= 15, 58 limit for mean &lt;= 25, 70 limit for mean &lt;= 33; max float between 0 and 1 is 0.99999999</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;}</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;__host__ __device__ __forceinline__ <span class="keywordtype">void</span> pois_iter(<span class="keywordtype">float</span> j, <span class="keywordtype">float</span> mean, <span class="keywordtype">float</span> &amp; emu, <span class="keywordtype">float</span> &amp; cdf){</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    emu *= mean*j;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    cdf += emu;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;}</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;__host__ __device__ __forceinline__ <span class="keywordtype">int</span> poiscdfinv(<span class="keywordtype">float</span> r, <span class="keywordtype">float</span> mean){</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordtype">float</span> emu = expf(-1 * mean);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordtype">float</span> cdf = emu;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 0; }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    pois_iter(1.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 1; }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    pois_iter(1.f/2.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 2; }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    pois_iter(1.f/3.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 3; }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    pois_iter(1.f/4.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 4; }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    pois_iter(1.f/5.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 5; }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    pois_iter(1.f/6.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 6; }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    pois_iter(1.f/7.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 7; }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    pois_iter(1.f/8.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 8; }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    pois_iter(1.f/9.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 9; }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    pois_iter(1.f/10.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 10; }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    pois_iter(1.f/11.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 1){ <span class="keywordflow">return</span> 11; }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    pois_iter(1.f/12.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 12; }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    pois_iter(1.f/13.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 13; }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    pois_iter(1.f/14.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 2){ <span class="keywordflow">return</span> 14; }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    pois_iter(1.f/15.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 15; }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    pois_iter(1.f/16.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 16; }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    pois_iter(1.f/17.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 3){ <span class="keywordflow">return</span> 17; }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    pois_iter(1.f/18.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 18; }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    pois_iter(1.f/19.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 19; }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    pois_iter(1.f/20.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 4){ <span class="keywordflow">return</span> 20; }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    pois_iter(1.f/21.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 21; }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    pois_iter(1.f/22.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 5){ <span class="keywordflow">return</span> 22; }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    pois_iter(1.f/23.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 23; }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    pois_iter(1.f/24.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 6){ <span class="keywordflow">return</span> 24; }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    pois_iter(1.f/25.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 25; }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    pois_iter(1.f/26.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 7){ <span class="keywordflow">return</span> 26; }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    pois_iter(1.f/27.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 27; }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    pois_iter(1.f/28.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 8){ <span class="keywordflow">return</span> 28; }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    pois_iter(1.f/29.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 29; }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    pois_iter(1.f/30.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 9){ <span class="keywordflow">return</span> 30; }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    pois_iter(1.f/31.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 31; }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    pois_iter(1.f/32.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 10){ <span class="keywordflow">return</span> 32; }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    pois_iter(1.f/33.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 33; }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    pois_iter(1.f/34.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 11){ <span class="keywordflow">return</span> 34; }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    pois_iter(1.f/35.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 35; }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    pois_iter(1.f/36.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 12){ <span class="keywordflow">return</span> 36; }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    pois_iter(1.f/37.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 37; }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    pois_iter(1.f/38.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 13){ <span class="keywordflow">return</span> 38; }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    pois_iter(1.f/39.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 39; }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    pois_iter(1.f/40.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 14){ <span class="keywordflow">return</span> 40; }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    pois_iter(1.f/41.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 15){ <span class="keywordflow">return</span> 41; }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    pois_iter(1.f/42.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 42; }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    pois_iter(1.f/43.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 16){ <span class="keywordflow">return</span> 43; }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    pois_iter(1.f/44.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 44; }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    pois_iter(1.f/45.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 17){ <span class="keywordflow">return</span> 45; }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    pois_iter(1.f/46.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 18){ <span class="keywordflow">return</span> 46; }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    pois_iter(1.f/47.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 47; }</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    pois_iter(1.f/48.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 19){ <span class="keywordflow">return</span> 48; }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    pois_iter(1.f/49.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 49; }</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    pois_iter(1.f/50.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 20){ <span class="keywordflow">return</span> 50; }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    pois_iter(1.f/51.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 21){ <span class="keywordflow">return</span> 51; }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    pois_iter(1.f/52.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 52; }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    pois_iter(1.f/53.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 22){ <span class="keywordflow">return</span> 53; }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    pois_iter(1.f/54.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 54; }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    pois_iter(1.f/55.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 23){ <span class="keywordflow">return</span> 55; }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    pois_iter(1.f/56.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 24){ <span class="keywordflow">return</span> 56; }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    pois_iter(1.f/57.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 57; }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    pois_iter(1.f/58.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 25){ <span class="keywordflow">return</span> 58; }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    pois_iter(1.f/59.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 26){ <span class="keywordflow">return</span> 59; }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    pois_iter(1.f/60.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 60; }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    pois_iter(1.f/61.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 27){ <span class="keywordflow">return</span> 61; }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    pois_iter(1.f/62.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 28){ <span class="keywordflow">return</span> 62; }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    pois_iter(1.f/63.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 63; }</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    pois_iter(1.f/64.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 29){ <span class="keywordflow">return</span> 64; }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    pois_iter(1.f/65.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 30){ <span class="keywordflow">return</span> 65; }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    pois_iter(1.f/66.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 66; }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    pois_iter(1.f/67.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 31){ <span class="keywordflow">return</span> 67; }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    pois_iter(1.f/68.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r || mean &lt;= 32){ <span class="keywordflow">return</span> 68; }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    pois_iter(1.f/69.f, mean, emu, cdf); <span class="keywordflow">if</span>(cdf &gt;= r){ <span class="keywordflow">return</span> 69; }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">return</span> 70; <span class="comment">//17 for mean &lt;= 3, 24 limit for mean &lt;= 6, 32 limit for mean &lt;= 10, 36 limit for mean &lt;= 12, 41 limit for mean &lt;= 15, 58 limit for mean &lt;= 25, 70 limit for mean &lt;= 33; max float between 0 and 1 is 0.99999999</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;__host__ __device__ __forceinline__ <span class="keywordtype">int</span> ApproxRandPois1(<span class="keywordtype">float</span> mean, <span class="keywordtype">float</span> var, <span class="keywordtype">float</span> p, <span class="keywordtype">float</span> N, int2 seed, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> generation, <span class="keywordtype">int</span> population){</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    uint4 i = Philox(seed, <span class="keywordtype">id</span>, generation, population, 0);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">if</span>(mean &lt;= RNG_MEAN_BOUNDARY_NORM){ <span class="keywordflow">return</span> poiscdfinv(uint_float_01(i.x), mean); }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(mean &gt;= N-RNG_MEAN_BOUNDARY_NORM){ <span class="keywordflow">return</span> N - poiscdfinv(uint_float_01(i.x), N-mean); } <span class="comment">//flip side of poisson, when 1-p is small</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">return</span> round(normcdfinv(uint_float_01(i.x))*sqrtf(var)+mean);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;__host__ __device__ __forceinline__ <span class="keywordtype">int</span> ApproxRandBinom1(<span class="keywordtype">float</span> mean, <span class="keywordtype">float</span> var, <span class="keywordtype">float</span> p, <span class="keywordtype">float</span> N, int2 seed, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> generation, <span class="keywordtype">int</span> population){</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    uint4 i = Philox(seed, <span class="keywordtype">id</span>, generation, population, 0);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span>(mean &lt;= RNG_MEAN_BOUNDARY_NORM){</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">if</span>(N &lt; RNG_N_BOUNDARY_POIS_BINOM){ <span class="keywordflow">return</span> binomcdfinv(uint_float_01(i.x), mean, mean/N, N); } <span class="keywordflow">else</span>{ <span class="keywordflow">return</span> poiscdfinv(uint_float_01(i.x), mean); }</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(mean &gt;= N-RNG_MEAN_BOUNDARY_NORM){ <span class="comment">//flip side of binomial, when 1-p is small</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">if</span>(N &lt; RNG_N_BOUNDARY_POIS_BINOM){ <span class="keywordflow">return</span> N - binomcdfinv(uint_float_01(i.x), N-mean, (N-mean)/N, N); } <span class="keywordflow">else</span>{ <span class="keywordflow">return</span> N - poiscdfinv(uint_float_01(i.x), N-mean); }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">return</span> round(normcdfinv(uint_float_01(i.x))*sqrtf(var)+mean);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;}</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">//faster if don&#39;t keep as separate compilation on both 780 and 980 GPUs! using static keyword to allow for fast compilation, works on 980, with whole program compilation works on 780 and even better on 980</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; __device__ __noinline__ <span class="keyword">static</span> <span class="keywordtype">int</span> ApproxRandBinomHelper(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, <span class="keywordtype">float</span> mean, <span class="keywordtype">float</span> var, <span class="keywordtype">float</span> N){</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span>(mean &lt;= RNG_MEAN_BOUNDARY_NORM){</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">if</span>(N &lt; RNG_N_BOUNDARY_POIS_BINOM){ <span class="keywordflow">return</span> binomcdfinv(uint_float_01(i), mean, mean/N, N); } <span class="keywordflow">else</span>{ <span class="keywordflow">return</span> poiscdfinv(uint_float_01(i), mean); }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(mean &gt;= N-RNG_MEAN_BOUNDARY_NORM){ <span class="comment">//flip side of binomial, when 1-p is small</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">if</span>(N &lt; RNG_N_BOUNDARY_POIS_BINOM){ <span class="keywordflow">return</span> N - binomcdfinv(uint_float_01(i), N-mean, (N-mean)/N, N); } <span class="keywordflow">else</span>{ <span class="keywordflow">return</span> N - poiscdfinv(uint_float_01(i), N-mean); }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">return</span> round(normcdfinv(uint_float_01(i))*sqrtf(var)+mean);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;__device__ __forceinline__ int4 ApproxRandBinom4(float4 mean, float4 var, float4 p, <span class="keywordtype">float</span> N, int2 seed, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> generation, <span class="keywordtype">int</span> population){</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    uint4 i = Philox(seed, <span class="keywordtype">id</span>, generation, population, 0);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">return</span> make_int4(ApproxRandBinomHelper(i.x, mean.x, var.x, N), ApproxRandBinomHelper(i.y, mean.y, var.y, N), ApproxRandBinomHelper(i.z, mean.z, var.z, N), ApproxRandBinomHelper(i.w, mean.w, var.w, N));</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">/* ----- end random number generation ----- */</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;} <span class="comment">/* ----- end namespace RNG ----- */</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* SHARED_CUH_ */</span><span class="preprocessor"></span></div><div class="ttc" id="namespace_r_n_g_html"><div class="ttname"><a href="namespace_r_n_g.html">RNG</a></div><div class="ttdef"><b>Definition:</b> <a href="rng_8cuh_source.html#l00023">rng.cuh:23</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_77b57fe7fc5bf30588b1aba5e8060878.html">3P</a></li><li class="navelem"><a class="el" href="dir_d144341474ce52587ff27e1528d46eab.html">_internal</a></li><li class="navelem"><b>rng.cuh</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
