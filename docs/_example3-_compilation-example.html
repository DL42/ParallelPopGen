<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Parallel PopGen Package: Example3-Compilation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Parallel PopGen Package
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_example3-_compilation-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example3-Compilation</div>  </div>
</div><!--header-->
<div class="contents">
<p>Compilation of different API features, including compilation. <br />
<br />
 Function <code>run_migration_equilibrium_simulation</code>, implemented in examples/example_compilation/run.cu, runs a simulation given a mutation rate and outputs result into allele trajectory <code>a</code>. The information from <code>a</code> is then copied to <code>b</code> and <code>a</code> is subsequently deleted. The information from <code>b</code> is then output to a file then to the terminal. <br />
<br />
 The main purpose of this is to show that simulation parameters can be passed from a standard C++ program to a CUDA program (*.cu), where the GPU-accelerated simulation is run, and then the simulation results in the form of an allele trajectory can be passed back to the C++ program and manipulated. So accelerated simulations can be inserted into any current C/C++ project. <a class="el" href="go__fish__data__struct_8h.html" title="Subset of go_fish.cuh (the GO_Fish data structures) ">go_fish_data_struct.h</a> is included in run.h (which is subsequently included in main.cpp). </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * main.cpp</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *      Author: David Lawrie</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;run.h&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv){</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    <a name="_a0"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories.html">GO_Fish::allele_trajectories</a> a;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    a.<a name="a1"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a2"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af7380836c9189ecbfe50945a1e90ae85">seed1</a> = 0xbeeff00d;                   <span class="comment">//random number seeds</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a3"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af2334ec2bc29ddb006030fc52f84e2cb">seed2</a> = 0xdecafbad;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="keywordtype">float</span> migration_rate = 0.005;                               <span class="comment">//migration proportion (equal between populations)</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    run_migration_equilibrium_simulation(a,migration_rate);     <span class="comment">//run simulation</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <a class="code" href="struct_g_o___fish_1_1allele__trajectories.html">GO_Fish::allele_trajectories</a> b = a;                         <span class="comment">//copy-assignment, copies a to b (unneeded, just showing it is possible)</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    a.<a name="a4"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#a6171d9ade75b32f839600e9645d17826">reset</a>();                                                  <span class="comment">//frees memory held by a (unneeded, just showing it is possible)</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="comment">/* --- output simulation information --- */</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    std::ofstream outfile;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    outfile.open(<span class="stringliteral">&quot;bfile.dat&quot;</span>);</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    outfile&lt;&lt;b;                                                 <span class="comment">//prints full allele_trajectory b to file</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    outfile.close();</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    std::cout&lt;&lt;std::endl&lt;&lt;<span class="stringliteral">&quot;number of time samples: &quot;</span> &lt;&lt; b.<a name="a5"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#a2c2c748362dfc891006002d3dc4431f2">num_time_samples</a>();</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    std::cout&lt;&lt;std::endl&lt;&lt;<span class="stringliteral">&quot;mutations in first time sample: &quot;</span> &lt;&lt; b.num_mutations_time_sample(0) &lt;&lt;std::endl&lt;&lt;<span class="stringliteral">&quot;mutations in final time sample: &quot;</span> &lt;&lt; b.maximal_num_mutations() &lt;&lt; std::endl; <span class="comment">//mutations in final time sample &gt;= mutations in first time sample as all mutations in the latter were preserved by sampling</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">//prints the first 10 mutations output from burn-in simulation</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    std::cout&lt;&lt;std::endl&lt;&lt;<span class="stringliteral">&quot;mutations from burn-in simulation\n&quot;</span>;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordtype">int</span> mutation_range_begin = 0; <span class="keywordtype">int</span> mutation_range_end = mutation_range_begin+10;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    std::cout&lt;&lt;<span class="stringliteral">&quot;ID\tstart frequency pop 1\tstart frequency pop 2\tfinal frequency pop 1\tfinal frequency pop 2&quot;</span>&lt;&lt;std::endl;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = mutation_range_begin; i &lt; mutation_range_end; i++){ std::cout&lt;&lt;b.mutation_ID(i)&lt;&lt;<span class="stringliteral">&quot;\t&quot;</span>&lt;&lt;b.frequency(0,0,i)&lt;&lt;<span class="stringliteral">&quot;\t&quot;</span>&lt;&lt;b.frequency(0,1,i)&lt;&lt;<span class="stringliteral">&quot;\t&quot;</span>&lt;&lt;b.frequency(1,0,i)&lt;&lt;<span class="stringliteral">&quot;\t&quot;</span>&lt;&lt;b.frequency(1,1,i)&lt;&lt;std::endl; }</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">//prints the first 10 mutations output from scenario simulation</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    std::cout&lt;&lt;std::endl&lt;&lt;<span class="stringliteral">&quot;mutations from scenario simulation\n&quot;</span>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    mutation_range_begin = b.num_mutations_time_sample(0); mutation_range_end = mutation_range_begin+10;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    std::cout&lt;&lt;<span class="stringliteral">&quot;ID\tstart frequency pop 1\tstart frequency pop 2\tfinal frequency pop 1\tfinal frequency pop 2&quot;</span>&lt;&lt;std::endl;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = mutation_range_begin; i &lt; mutation_range_end; i++){ std::cout&lt;&lt;b.mutation_ID(i)&lt;&lt;<span class="stringliteral">&quot;\t&quot;</span>&lt;&lt;b.frequency(0,0,i)&lt;&lt;<span class="stringliteral">&quot;\t&quot;</span>&lt;&lt;b.frequency(0,1,i)&lt;&lt;<span class="stringliteral">&quot;\t&quot;</span>&lt;&lt;b.frequency(1,0,i)&lt;&lt;<span class="stringliteral">&quot;\t&quot;</span>&lt;&lt;b.frequency(1,1,i)&lt;&lt;std::endl; }</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">/* --- end output simulation information --- */</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div><div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_af2334ec2bc29ddb006030fc52f84e2cb"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af2334ec2bc29ddb006030fc52f84e2cb">GO_Fish::allele_trajectories::sim_constants::seed2</a></div><div class="ttdeci">int seed2</div><div class="ttdoc">random number seed 2 of 2 </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00059">go_fish_data_struct.h:59</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html">GO_Fish::allele_trajectories</a></div><div class="ttdoc">control and output data structure for GO_Fish simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00054">go_fish_data_struct.h:54</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html_a6171d9ade75b32f839600e9645d17826"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html#a6171d9ade75b32f839600e9645d17826">GO_Fish::allele_trajectories::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdoc">deletes all memory held by allele_trajectories, resets constants to default </div><div class="ttdef"><b>Definition:</b> <a href="inline__go__fish__data__struct_8hpp_source.html#l00174">inline_go_fish_data_struct.hpp:174</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html_a2c2c748362dfc891006002d3dc4431f2"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html#a2c2c748362dfc891006002d3dc4431f2">GO_Fish::allele_trajectories::num_time_samples</a></div><div class="ttdeci">int num_time_samples()</div><div class="ttdoc">returns number of time samples taken during simulation run </div><div class="ttdef"><b>Definition:</b> <a href="inline__go__fish__data__struct_8hpp_source.html#l00089">inline_go_fish_data_struct.hpp:89</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_af7380836c9189ecbfe50945a1e90ae85"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af7380836c9189ecbfe50945a1e90ae85">GO_Fish::allele_trajectories::sim_constants::seed1</a></div><div class="ttdeci">int seed1</div><div class="ttdoc">random number seed 1 of 2 </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00058">go_fish_data_struct.h:58</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html_aeb34bc193f8493c481313a83163f931f"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">GO_Fish::allele_trajectories::sim_input_constants</a></div><div class="ttdeci">sim_constants sim_input_constants</div><div class="ttdoc">constants for initializing the next simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00072">go_fish_data_struct.h:72</a></div></div>
</div><!-- fragment --><p> The simulation starts off blank, running a burn-in simulation until equilibrium is reached, then running the scenario of interest. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * run_sim.h</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *      Author: dlawrie</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="go__fish__data__struct_8h.html">go_fish_data_struct.h</a>&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#ifndef RUN_SIM_H_</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#define RUN_SIM_H_</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keywordtype">void</span> run_migration_equilibrium_simulation(<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html">GO_Fish::allele_trajectories</a> &amp; a, <span class="keywordtype">float</span> migration_rate);</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* RUN_SIM_H_ */</span><span class="preprocessor"></span></div><div class="ttc" id="go__fish__data__struct_8h_html"><div class="ttname"><a href="go__fish__data__struct_8h.html">go_fish_data_struct.h</a></div><div class="ttdoc">Subset of go_fish.cuh (the GO_Fish data structures) </div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html">GO_Fish::allele_trajectories</a></div><div class="ttdoc">control and output data structure for GO_Fish simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00054">go_fish_data_struct.h:54</a></div></div>
</div><!-- fragment --><p> The below code for example_compilation/run.cu must also include <a class="el" href="go__fish_8cuh.html" title="GO Fish Simulation API (contains namespaces GO_Fish and Sim_Model) ">go_fish.cuh</a> in order to run the simulations as including run.h only includes the <a class="el" href="namespace_g_o___fish.html" title="Namespace for single-locus, forward, Monte-Carlo Wright-Fisher simulation and output data structures...">GO_Fish</a> data structures. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * run.cu</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *      Author: David Lawrie</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="go__fish_8cuh.html">go_fish.cuh</a>&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;run.h&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//scenario: two populations start in mutation-selection-migration equilibrium with weakly deleterious mutations, then simulate what happens after mutations in population 1 become beneficial (1,000 generations)</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//migration set in main.cpp</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keywordtype">void</span> run_migration_equilibrium_simulation(<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html">GO_Fish::allele_trajectories</a> &amp; a, <span class="keywordtype">float</span> migration_rate){</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    <span class="keyword">using namespace </span><a class="code" href="namespace_sim___model.html">Sim_Model</a>;                              <span class="comment">//using namespace Sim_Model (avoids Sim_Model::, but compiler can get confused if multiple functions from different namespaces have same name and Sim_Model:: shows ownership)</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="keyword">using namespace </span><a class="code" href="namespace_g_o___fish.html">GO_Fish</a>;                                <span class="comment">//using namespace GO_Fish (avoids GO_Fish::, but compiler can get confused if multiple functions from different namespaces have same name and GO_Fish:: shows ownership)</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a6"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a1bfe24f3cfc8c2b1ca02a7e8f39d78ed">num_sites</a> = 20*pow(10.f,7);       <span class="comment">//number of sites</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a7"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#affaa6a67d6590f1c9e99769adebf82a9">num_populations</a> = 2;              <span class="comment">//number of populations</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a8"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a62137334ca292069cf24f4635ef26e21">init_mse</a> = <span class="keyword">false</span>;                 <span class="comment">//start from blank simulation</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <a name="_a9"></a><a class="code" href="struct_sim___model_1_1_f__mu__h__constant.html">F_mu_h_constant</a> mutation(pow(10.f,-9));                 <span class="comment">//per-site mutation rate</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <a class="code" href="struct_sim___model_1_1_f__mu__h__constant.html">F_mu_h_constant</a> inbreeding(1.f);                        <span class="comment">//constant inbreeding</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <a name="_a10"></a><a class="code" href="struct_sim___model_1_1demography__constant.html">demography_constant</a> demography(1000);                   <span class="comment">//number of individuals in both populations</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <a name="_a11"></a><a class="code" href="struct_sim___model_1_1migration__constant__equal.html">migration_constant_equal</a> migration(migration_rate,a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#affaa6a67d6590f1c9e99769adebf82a9">num_populations</a>); <span class="comment">//constant migration rate</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <a name="_a12"></a><a class="code" href="struct_sim___model_1_1selection__constant.html">selection_constant</a> deleterious(-1.f/1000.f);            <span class="comment">//constant selection coefficient (weakly deleterious)</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <a class="code" href="struct_sim___model_1_1_f__mu__h__constant.html">F_mu_h_constant</a> dominance(0.f);                         <span class="comment">//constant allele dominance (ignored as population is fully inbred)</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <a name="_a13"></a><a class="code" href="struct_sim___model_1_1bool__off.html">bool_off</a> dont_preserve;                                 <span class="comment">//don&#39;t preserve mutations</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <a class="code" href="struct_sim___model_1_1bool__off.html">bool_off</a> dont_sample;                                   <span class="comment">//don&#39;t sample generations</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a14"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a3a5406282cfa4db45a72213bd5e50e65">compact_interval</a> = 100;           <span class="comment">//interval between compacts</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a15"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a24c743e3051a7c443742436154e545b0">num_generations</a> = 2*pow(10.f,4);  <span class="comment">//burn-in simulation to achieve migration equilibrium 20,0000 generations</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <a name="a16"></a><a class="code" href="namespace_g_o___fish.html#a7e11d273a799f6ddbda24e3115a49083">run_sim</a>(a,mutation,demography,migration,deleterious,inbreeding,dominance,dont_preserve,dont_sample); <span class="comment">//only sample final generation</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="struct_g_o___fish_1_1allele__trajectories.html">allele_trajectories</a> c(a);                               <span class="comment">//copy constructor, copies a to c (not actually needed for this simulation, just showing it is possible)</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a name="_a17"></a><a class="code" href="struct_sim___model_1_1bool__on.html">bool_on</a> sample;                                         <span class="comment">//sample generation</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a name="_a18"></a><a class="code" href="struct_sim___model_1_1bool__pulse.html">bool_pulse&lt;bool_off,bool_on&gt;</a> sample_strategy(dont_sample,sample,0,a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a24c743e3051a7c443742436154e545b0">num_generations</a>); <span class="comment">//sample starting generation of second simulation (i.e. last generation of burn-in simulation)</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a24c743e3051a7c443742436154e545b0">num_generations</a> = pow(10.f,3);    <span class="comment">//scenario simulation 1,0000 generations</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a19"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#aa4dc5c8eba55b819bc6325a839bfb5a9">prev_sim_sample</a> = 0;              <span class="comment">//start from previous simulation time sample 0</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="struct_sim___model_1_1selection__constant.html">selection_constant</a> beneficial(20.f/1000.f);             <span class="comment">//constant selection coefficient (beneficial)</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a name="_a20"></a><a class="code" href="struct_sim___model_1_1selection__population__specific.html">selection_population_specific&lt;selection_constant,selection_constant&gt;</a> selection_model(deleterious,beneficial,1); <span class="comment">//selection in population 1</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="namespace_g_o___fish.html#a7e11d273a799f6ddbda24e3115a49083">run_sim</a>(a,mutation,demography,migration,selection_model,inbreeding,dominance,dont_preserve,sample_strategy,a); <span class="comment">//scenario simulation, start from migration equilibrium, sample both start and final generations</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;}</div><div class="ttc" id="struct_sim___model_1_1selection__constant_html"><div class="ttname"><a href="struct_sim___model_1_1selection__constant.html">Sim_Model::selection_constant</a></div><div class="ttdoc">functor: models selection coefficient s as a constant across populations and over time ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00032">go_fish.cuh:32</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_aa4dc5c8eba55b819bc6325a839bfb5a9"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#aa4dc5c8eba55b819bc6325a839bfb5a9">GO_Fish::allele_trajectories::sim_constants::prev_sim_sample</a></div><div class="ttdeci">int prev_sim_sample</div><div class="ttdoc">time sample of previous simulation to use for initializing current simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00064">go_fish_data_struct.h:64</a></div></div>
<div class="ttc" id="struct_sim___model_1_1bool__off_html"><div class="ttname"><a href="struct_sim___model_1_1bool__off.html">Sim_Model::bool_off</a></div><div class="ttdoc">functor: turns sampling and preserving off (for every generation except the final one which is always...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00272">go_fish.cuh:272</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html">GO_Fish::allele_trajectories</a></div><div class="ttdoc">control and output data structure for GO_Fish simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00054">go_fish_data_struct.h:54</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_a3a5406282cfa4db45a72213bd5e50e65"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a3a5406282cfa4db45a72213bd5e50e65">GO_Fish::allele_trajectories::sim_constants::compact_interval</a></div><div class="ttdeci">int compact_interval</div><div class="ttdoc">how often to compact the simulation and remove fixed or lost mutations </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00065">go_fish_data_struct.h:65</a></div></div>
<div class="ttc" id="struct_sim___model_1_1demography__constant_html"><div class="ttname"><a href="struct_sim___model_1_1demography__constant.html">Sim_Model::demography_constant</a></div><div class="ttdoc">functor: single, constant population size (N individuals) across populations and over time ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00154">go_fish.cuh:154</a></div></div>
<div class="ttc" id="struct_sim___model_1_1selection__population__specific_html"><div class="ttname"><a href="struct_sim___model_1_1selection__population__specific.html">Sim_Model::selection_population_specific</a></div><div class="ttdoc">functor: one population, pop, has a different, selection function, s_pop, all other have function s ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00072">go_fish.cuh:72</a></div></div>
<div class="ttc" id="namespace_sim___model_html"><div class="ttname"><a href="namespace_sim___model.html">Sim_Model</a></div><div class="ttdoc">Namespace of functions for controlling GO_Fish simulations. </div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00026">go_fish.cuh:26</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_affaa6a67d6590f1c9e99769adebf82a9"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#affaa6a67d6590f1c9e99769adebf82a9">GO_Fish::allele_trajectories::sim_constants::num_populations</a></div><div class="ttdeci">int num_populations</div><div class="ttdoc">number of populations in simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00062">go_fish_data_struct.h:62</a></div></div>
<div class="ttc" id="struct_sim___model_1_1_f__mu__h__constant_html"><div class="ttname"><a href="struct_sim___model_1_1_f__mu__h__constant.html">Sim_Model::F_mu_h_constant</a></div><div class="ttdoc">functor: models parameter p as a constant across populations and over time </div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00101">go_fish.cuh:101</a></div></div>
<div class="ttc" id="struct_sim___model_1_1migration__constant__equal_html"><div class="ttname"><a href="struct_sim___model_1_1migration__constant__equal.html">Sim_Model::migration_constant_equal</a></div><div class="ttdoc">functor: migration flows at rate m from pop i to pop j =/= i and 1-(num_pop-1)*m for i == j ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00232">go_fish.cuh:232</a></div></div>
<div class="ttc" id="struct_sim___model_1_1bool__on_html"><div class="ttname"><a href="struct_sim___model_1_1bool__on.html">Sim_Model::bool_on</a></div><div class="ttdoc">functor: turns sampling and preserving on (for every generation except the final one which is always ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00277">go_fish.cuh:277</a></div></div>
<div class="ttc" id="go__fish_8cuh_html"><div class="ttname"><a href="go__fish_8cuh.html">go_fish.cuh</a></div><div class="ttdoc">GO Fish Simulation API (contains namespaces GO_Fish and Sim_Model) </div></div>
<div class="ttc" id="namespace_g_o___fish_html_a7e11d273a799f6ddbda24e3115a49083"><div class="ttname"><a href="namespace_g_o___fish.html#a7e11d273a799f6ddbda24e3115a49083">GO_Fish::run_sim</a></div><div class="ttdeci">__host__ void run_sim(allele_trajectories &amp;all_results, const Functor_mutation mu_rate, const Functor_demography demography, const Functor_migration mig_prop, const Functor_selection sel_coeff, const Functor_inbreeding FI, const Functor_dominance dominance, const Functor_preserve preserve_mutations, const Functor_timesample take_sample)</div><div class="ttdoc">runs a single-locus Wright-Fisher simulation specified by the given simulation functions and sim_cons...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish__impl_8cuh_source.html#l00525">go_fish_impl.cuh:525</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_a1bfe24f3cfc8c2b1ca02a7e8f39d78ed"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a1bfe24f3cfc8c2b1ca02a7e8f39d78ed">GO_Fish::allele_trajectories::sim_constants::num_sites</a></div><div class="ttdeci">float num_sites</div><div class="ttdoc">number of sites in simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00061">go_fish_data_struct.h:61</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_a62137334ca292069cf24f4635ef26e21"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a62137334ca292069cf24f4635ef26e21">GO_Fish::allele_trajectories::sim_constants::init_mse</a></div><div class="ttdeci">bool init_mse</div><div class="ttdoc">true: initialize simulation in mutation_selection_equilibrium; false: initialize blank simulation or ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00063">go_fish_data_struct.h:63</a></div></div>
<div class="ttc" id="namespace_g_o___fish_html"><div class="ttname"><a href="namespace_g_o___fish.html">GO_Fish</a></div><div class="ttdoc">Namespace for single-locus, forward, Monte-Carlo Wright-Fisher simulation and output data structures...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00326">go_fish.cuh:326</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html_aeb34bc193f8493c481313a83163f931f"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">GO_Fish::allele_trajectories::sim_input_constants</a></div><div class="ttdeci">sim_constants sim_input_constants</div><div class="ttdoc">constants for initializing the next simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00072">go_fish_data_struct.h:72</a></div></div>
<div class="ttc" id="struct_sim___model_1_1bool__pulse_html"><div class="ttname"><a href="struct_sim___model_1_1bool__pulse.html">Sim_Model::bool_pulse</a></div><div class="ttdoc">functor: returns the result of function f_default except at generation pulse returns the result of fu...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00298">go_fish.cuh:298</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_a24c743e3051a7c443742436154e545b0"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a24c743e3051a7c443742436154e545b0">GO_Fish::allele_trajectories::sim_constants::num_generations</a></div><div class="ttdeci">int num_generations</div><div class="ttdoc">number of generations in simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00060">go_fish_data_struct.h:60</a></div></div>
</div><!-- fragment --><p> <b>Pro Tip:</b> A nice thing about CUDA is the flexibility it gives in compiling mixed C/C++ and CUDA programs. Below is an example where the entire program can alternatively be compiled by NVCC (the NVIDIA CUDA compiler) - e.g. makefile_nvcc - or by g++ &amp; NVCC where NVCC compiles just the GPU-accelerated portions and then hands the linking over g++ - e.g. makefile_gpp. The master makefile controls which is called. This is useful if you are adding the simulation to your own project compiled with a certain compiler that you do not want to change for the code you have written. The CUDA code essentially becomes an accelerated library that you can use in your current project. Master makefile, each line is documented by the top part of the makefile: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Description of Mac/Linux/Unix Makefile for example_compilation.</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;# makefile_nvcc is useful when combining GPU-accelerated code into an existing C++ project and using NVCC to compile all files and link objects into executable.</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;# makefile_gpp is useful when combining GPU-accelerated code into an existing C++ project and user wants to keep non-CUDA code compiled by a different compiler (e.g. g++). </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;#</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;#############################</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;# build_path := Where to build program and put executable (note: folder must already exist)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# EXEC_FILE := Name of executable </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;#</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;# cpp_object_names := CPP objects required for executable</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;# cpp_objects := Prepends build path to object names</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;#</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;# cuda_object_names := CUDA objects required for executable</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;# cuda_objects := Prepends build path to object names</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;#</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;# nvcc := Command &#39;make&#39; or &#39;make nvcc&#39; calls the makefile makefile_nvcc</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;#</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;# gpp := Command &#39;make gpp&#39; calls the makefile makefile_gpp</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;#</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;# .PHONY := Defines &#39;nvvc&#39;, &#39;gpp&#39;, and &#39;clean&#39; as not true targets (i.e. don&#39;t remake executable if can&#39;t find files called &#39;all&#39; or &#39;clean&#39;)</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;#</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;# clean := Action to perform for command &#39;make clean&#39;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;#  Remove all objects and EXEC_FILE from build_path</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;#############################</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;build_path = ../example_compilation</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;EXEC_FILE = GOFish</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;cpp_object_names = main.o</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;cpp_objects = $(addprefix $(build_path)/,$(cpp_object_names))</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;cuda_object_names = run.o shared.o go_fish_impl.o</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;cuda_objects = $(addprefix $(build_path)/,$(cuda_object_names))</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;nvcc: </div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;   make -f makefile_nvcc</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;gpp:</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;   make -f makefile_gpp</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;.PHONY: nvcc gpp clean</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;clean:</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;   rm -f $(cuda_objects) $(cpp_objects) $(build_path)/gpuCode.o $(build_path)/$(EXEC_FILE)</div></div><!-- fragment --><p> makefile_nvcc, each line is documented by the top part of the makefile: <br />
<br />
 <b>Tip:</b> The makefile below compiles machine code explicitly for generation 3.0 and 5.2 GPUs and uses just in time (JIT) compilation for everything else (lowest GPU generation which works for 3P is 3.0). Compilation (and program execution) will be faster if compiling for <b>your specific GPU</b>. <br />
<br />
 e.g. if running a Tesla K20 or Tesla K40, <a href="https://developer.nvidia.com/cuda-gpus">then the corresponding GPU generation is 3.5</a>: all the current <code>--generate-code arch=##,code=##</code> flags can be deleted and replaced with <code>--generate-code arch=compute_35,code=sm_35</code>. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Description of Mac/Linux/Unix Makefile for example_compilation. </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;# NVCC compiles C++ and CUDA code and links all objects into an exectuable.</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;#</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;#############################</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;# build_path := Where to build program and put executable (note: folder must already exist)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;# api_path_source := Location of API source folder</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# api_path_include := Location of API include folder</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;# EXEC_FILE := Name of executable </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;#</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;# NVCC := Compiler path, in this case nvcc is in $PATH</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;# CFLAGS_CUDA := Compiler Flags for CUDA (*.cu) Files: optimize most, fast math, add API include folder to include search path, equivalent to --relocatable-device-code=true --compile</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;# CFLAGS_CPP := Compiler Flags for CPP (main.cpp) Files: optimize most, add API include folder to include search path, compile</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;# CODE := GPU types for which to build explicitly (I have a NVIDIA GTX 780M and 980) https://developer.nvidia.com/cuda-gpus, creates machine code for code=sm_30 (780) and code=sm_52 (980) and virtual architectures for all other generations which can be compiled JIT - code=compute_30 for generations between (3.0,5.0) and code=compute_50 for generations (5.0 and up) http://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html#options-for-steering-gpu-code-generation</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;#</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;# cpp_object_names := CPP objects required for executable</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;# cpp_objects := Prepends build path to object names</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;#</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;# cuda_object_names := CUDA objects required for executable</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;# cuda_objects := Prepends build path to object names</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;#</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;# all := Command &#39;make&#39; or &#39;make all&#39; builds executable file $(EXEC_FILE) in location $(build_path)/</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;#</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;# ##### Object Dependencies Lists #####</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;# If one of the files on the right hand side of the : changes, the corresponding object must be recompiled.</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;# This is a users makefile - it assumes there will be no changes to the GOFish API files, so does not include</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;# all the non-*.cu (non source file) dependencies except those that the user created (i.e. run.h). If changes </div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;# to the API .h or .cuh files are expected see Object Dependencies Lists in example_dadi or run &#39;make clean&#39; </div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;# before each &#39;make all&#39;.</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;# ##### End Object Dependencies Lists #####</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;#</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;# $(cpp_objects) := Make target all objects</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;#  Compile CPP source code into objects, $&lt; := dependencies from Object Dependencies Lists, $@ := object in $(objects)</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;#</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;# $(cuda_objects) := Make target all objects</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;#  Compile CUDA source code into objects, $&lt; := dependencies from Object Dependencies Lists, $@ := object in $(objects)</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;#</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;# $(build_path)/$(EXEC_FILE) := Make target executable EXEC_FILE which depends on all objects</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;#  Link CUDA/CPP objects into executable EXEC_FILE, $@ := $(build_path)/$(EXEC_FILE)</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;#</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;# .PHONY := Defines &#39;all&#39; as not a true target (i.e. don&#39;t remake executable if can&#39;t find a file called &#39;all&#39;)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;#############################</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;build_path = ../example_compilation</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;api_path_source = ../../3P/_internal</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;api_path_include = ../../3P</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;EXEC_FILE = GOFish</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;NVCC = nvcc</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;CFLAGS_CUDA = -O3 --use_fast_math -I $(api_path_include)/ -dc</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;CFLAGS_CPP = -O3 -I $(api_path_include)/ -c</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;CODE = --generate-code arch=compute_30,code=sm_30 --generate-code arch=compute_52,code=sm_52 --generate-code arch=compute_30,code=compute_30 --generate-code arch=compute_52,code=compute_52</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;cpp_object_names = main.o</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;cpp_objects = $(addprefix $(build_path)/,$(cpp_object_names))</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;cuda_object_names = run.o shared.o go_fish_impl.o</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;cuda_objects = $(addprefix $(build_path)/,$(cuda_object_names))</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;all: $(build_path)/$(EXEC_FILE)</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;##### OBJECT DEPENDENCIES #####</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;$(build_path)/main.o: main.cpp run.h</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;$(build_path)/run.o: run.cu run.h</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;$(build_path)/shared.o: $(api_path_source)/shared.cu</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;$(build_path)/go_fish_impl.o: $(api_path_source)/go_fish_impl.cu</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;##### END OBJECT DEPENDENCIES #####</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;$(cpp_objects):</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   $(NVCC) $(CFLAGS_CPP) $&lt; -o $@</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;$(cuda_objects):</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;   $(NVCC) $(CODE) $(CFLAGS_CUDA) $&lt; -o $@</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;$(build_path)/$(EXEC_FILE): $(cpp_objects) $(cuda_objects)</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   $(NVCC) $(CODE) $(cpp_objects) $(cuda_objects)  -o $@</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;.PHONY: all</div></div><!-- fragment --><p> makefile_gpp, each line is documented by the top part of the makefile: <br />
<br />
 <b>Tip:</b> The makefile below compiles machine code explicitly for generation 3.0 and 5.2 GPUs and uses just in time (JIT) compilation for everything else (lowest GPU generation which works for 3P is 3.0). Compilation (and program execution) will be faster if compiling for <b>your specific GPU</b>. <br />
<br />
 e.g. if running a Tesla K20 or Tesla K40, <a href="https://developer.nvidia.com/cuda-gpus">then the corresponding GPU generation is 3.5</a>: all the current <code>--generate-code arch=##,code=##</code> flags can be deleted and replaced with <code>--generate-code arch=compute_35,code=sm_35</code>. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Description of Mac/Linux/Unix Makefile for example_compilation using g++ to compile the C++ code and link objects into executable. </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;# NVCC compiles CUDA code and links device (GPU) code into an object that can be understood by g++ with the help of the CUDA Runtime Library.</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;#</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;#############################</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;# build_path := Where to build program and put executable (note: folder must already exist)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;# api_path_source := Location of API source folder</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# api_path_include := Location of API include folder</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;# EXEC_FILE := Name of executable </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;#</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;# CC := Compiler, in this case g++</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;# NVCC := Compiler path, in this case nvcc is in $PATH</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;# CFLAGS_CUDA := Compiler Flags for CUDA (*.cu) Files: optimize most, fast math, add API include folder to include search path, equivalent to --relocatable-device-code=true --compile</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;# CFLAGS_CPP := Compiler Flags for CPP (main.cpp) Files: optimize most, add API include folder to include search path, compile</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;# CODE := GPU types for which to build explicitly (I have a NVIDIA GTX 780M and 980) https://developer.nvidia.com/cuda-gpus, creates machine code for code=sm_30 (780) and code=sm_52 (980) and virtual architectures for all other generations which can be compiled JIT - code=compute_30 for generations between (3.0,5.0) and code=compute_50 for generations (5.0 and up) http://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html#options-for-steering-gpu-code-generation</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;# LIB_CUDART := Location of the CUDA Runtime API</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;# </div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;# cpp_object_names := CPP objects required for executable</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;# cpp_objects := Prepends build path to object names</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;#</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;# cuda_object_names := CUDA objects required for executable</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;# cuda_objects := Prepends build path to object names</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;#</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;# all := Command &#39;make&#39; or &#39;make all&#39; builds executable file $(EXEC_FILE) in location $(build_path)/</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;#</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;# ##### Object Dependencies Lists #####</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;# If one of the files on the right hand side of the : changes, the corresponding object must be recompiled.</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;# This is a users makefile - it assumes there will be no changes to the GOFish API files, so does not include</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;# all the non-*.cu (non source file) dependencies except those that the user created (i.e. run.h). If changes </div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;# to the API .h or .cuh files are expected see Object Dependencies Lists in example_dadi or run &#39;make clean&#39; </div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;# before each &#39;make all&#39;.</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;# ##### End Object Dependencies Lists #####</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;#</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;# $(cpp_objects) := Make target all objects</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;#  Use g++ to compile CPP source code into objects, $&lt; := dependencies from Object Dependencies Lists, $@ := object in $(objects)</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;#</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;# $(cuda_objects) := Make target all objects</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;#  Use nvcc to compile CUDA source code into objects, $&lt; := dependencies from Object Dependencies Lists, $@ := object in $(objects)</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;#</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;# $(build_path)/gpuCode.o := Make target CUDA object which depends on cuda objects</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;#  Use nvcc to link device code from CUDA objects into object gpuCode.o, $@ := $(build_path)/gpuCode.o</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;#</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;# $(build_path)/$(EXEC_FILE) := Make target executable EXEC_FILE which depends on all objects</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;#  Use g++ to link CUDA/CPP objects into executable EXEC_FILE reintegrating device code using gpuCode.o and the CUDA runtime library, $@ := $(build_path)/$(EXEC_FILE)</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;#</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;# .PHONY := Defines &#39;all&#39; as not a true target (i.e. don&#39;t remake executable if can&#39;t find a file called &#39;all&#39;)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;#############################</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;build_path = ../example_compilation</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;api_path_source = ../../3P/_internal</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;api_path_include = ../../3P</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;EXEC_FILE = GOFish</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;CC = g++</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;NVCC = nvcc</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;CFLAGS_CUDA = -O3 --use_fast_math -I $(api_path_include)/ -dc</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;CFLAGS_CPP = -O3 -I $(api_path_include)/ -c</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;CODE = --generate-code arch=compute_30,code=sm_30 --generate-code arch=compute_52,code=sm_52 --generate-code arch=compute_30,code=compute_30 --generate-code arch=compute_52,code=compute_52</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;LIB_CUDART = -L/usr/local/cuda/lib -lcudart</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;cpp_object_names = main.o</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;cpp_objects = $(addprefix $(build_path)/,$(cpp_object_names))</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;cuda_object_names = run.o shared.o go_fish_impl.o</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;cuda_objects = $(addprefix $(build_path)/,$(cuda_object_names))</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;all: $(build_path)/$(EXEC_FILE)</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;##### OBJECT DEPENDENCIES #####</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;$(build_path)/main.o: main.cpp run.h</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;$(build_path)/run.o: run.cu run.h</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;$(build_path)/shared.o: $(api_path_source)/shared.cu</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;$(build_path)/go_fish_impl.o: $(api_path_source)/go_fish_impl.cu</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;##### END OBJECT DEPENDENCIES #####</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;$(cpp_objects):</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   $(CC) $(CFLAGS_CPP) $&lt; -o $@</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;$(cuda_objects):</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;   $(NVCC) $(CODE) $(CFLAGS_CUDA) $&lt; -o $@</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;$(build_path)/gpuCode.o: $(cuda_objects)</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;   $(NVCC) $(CODE) -dlink $(cuda_objects) -o $@</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;$(build_path)/$(EXEC_FILE): $(cpp_objects) $(cuda_objects) $(build_path)/gpuCode.o</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;   $(CC) $(cpp_objects) $(build_path)/gpuCode.o $(cuda_objects) $(LIB_CUDART) -o $@</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;.PHONY: all </div></div><!-- fragment --><div class="fragment"></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
