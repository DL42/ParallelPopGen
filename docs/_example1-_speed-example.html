<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Parallel PopGen Package: Example1-Speed</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Parallel PopGen Package
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_example1-_speed-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example1-Speed</div>  </div>
</div><!--header-->
<div class="contents">
<p>A simple, benchmarking scenario. <br />
<br />
Below code tests the speed of a neutral, constant population simulation on a GPU: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * run.cu</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *      Author: David Lawrie</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="go__fish_8cuh.html">go_fish.cuh</a>&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keywordtype">void</span> run_speed_test()</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;{</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    <span class="comment">//----- speed test scenario parameters -----</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    <a name="_a0"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories.html">GO_Fish::allele_trajectories</a> a;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    a.<a name="a1"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a2"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#affaa6a67d6590f1c9e99769adebf82a9">num_populations</a> = 1;                                  <span class="comment">//1 population</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <a name="_a3"></a><a class="code" href="struct_sim___model_1_1_f__mu__h__constant.html">Sim_Model::F_mu_h_constant</a> mutation(pow(10.f,-9));                          <span class="comment">//per-site mutation rate 10^-9</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <a class="code" href="struct_sim___model_1_1_f__mu__h__constant.html">Sim_Model::F_mu_h_constant</a> inbreeding(1.f);                                 <span class="comment">//constant inbreeding (fully inbred)</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <a name="_a4"></a><a class="code" href="struct_sim___model_1_1demography__constant.html">Sim_Model::demography_constant</a> demography(pow(10.f,5)*(1+inbreeding(0,0))); <span class="comment">//200,000 haploid individuals in population, set to maintain consistent effective number of chromosomes invariant w.r.t. inbreeding</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <a name="_a5"></a><a class="code" href="struct_sim___model_1_1migration__constant__equal.html">Sim_Model::migration_constant_equal</a> migration;                              <span class="comment">//constant, 0, migration rate</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <a name="_a6"></a><a class="code" href="struct_sim___model_1_1selection__constant.html">Sim_Model::selection_constant</a> selection(0);                                 <span class="comment">//constant, neutral, selection coefficient</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <a class="code" href="struct_sim___model_1_1_f__mu__h__constant.html">Sim_Model::F_mu_h_constant</a> dominance(0.f);                                  <span class="comment">//constant allele dominance (effectively ignored since F = 1)</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a7"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a24c743e3051a7c443742436154e545b0">num_generations</a> = pow(10.f,3);                        <span class="comment">//1,000 generations in simulation</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a8"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af7380836c9189ecbfe50945a1e90ae85">seed1</a> = 0xbeeff00d;                                   <span class="comment">//random number seeds</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a9"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af2334ec2bc29ddb006030fc52f84e2cb">seed2</a> = 0xdecafbad;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a10"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a1bfe24f3cfc8c2b1ca02a7e8f39d78ed">num_sites</a> = 20*2*pow(10.f,7);                         <span class="comment">//number of sites</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a11"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a3a5406282cfa4db45a72213bd5e50e65">compact_interval</a> = 15;                                <span class="comment">//compact interval (in general: decrease compact interval for larger number of sites)</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="comment">//----- end speed test scenario parameters -----</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">//----- speed test -----</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    cudaEvent_t start, stop;                                                    <span class="comment">//CUDA timing functions</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordtype">float</span> elapsedTime;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordtype">int</span> num_iter = 20;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    cudaEventCreate(&amp;start);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    cudaEventCreate(&amp;stop);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; num_iter; i++){</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keywordflow">if</span>(i == num_iter/2){ cudaEventRecord(start, 0); }                       <span class="comment">//use half of the simulations to warm-up GPU, the other half to time simulation runs</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <a name="a12"></a><a class="code" href="namespace_g_o___fish.html#a7e11d273a799f6ddbda24e3115a49083">GO_Fish::run_sim</a>(a,mutation,demography,migration,selection,inbreeding,dominance,<a name="_a13"></a><a class="code" href="struct_sim___model_1_1bool__off.html">Sim_Model::bool_off</a>(),<a class="code" href="struct_sim___model_1_1bool__off.html">Sim_Model::bool_off</a>());</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    }</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    elapsedTime = 0;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    cudaEventRecord(stop, 0);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    cudaEventSynchronize(stop);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    cudaEventElapsedTime(&amp;elapsedTime, start, stop);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    cudaEventDestroy(start);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    cudaEventDestroy(stop);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    std::cout&lt;&lt;<span class="stringliteral">&quot;number of sites:\t&quot;</span>&lt;&lt; a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a1bfe24f3cfc8c2b1ca02a7e8f39d78ed">num_sites</a>&lt;&lt;std::endl&lt;&lt; <span class="stringliteral">&quot;compact interval:\t&quot;</span>&lt;&lt; a.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a3a5406282cfa4db45a72213bd5e50e65">compact_interval</a>&lt;&lt;std::endl&lt;&lt;<span class="stringliteral">&quot;number of mutations:\t&quot;</span>&lt;&lt;a.<a name="a14"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#ad426e41a3fec6914e16390500889fd0d">maximal_num_mutations</a>()&lt;&lt;std::endl&lt;&lt;<span class="stringliteral">&quot;time elapsed (ms):\t&quot;</span>&lt;&lt;2*elapsedTime/num_iter&lt;&lt;std::endl;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">//----- end speed test -----</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;}</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv){ run_speed_test(); }</div><div class="ttc" id="struct_sim___model_1_1selection__constant_html"><div class="ttname"><a href="struct_sim___model_1_1selection__constant.html">Sim_Model::selection_constant</a></div><div class="ttdoc">functor: models selection coefficient s as a constant across populations and over time ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00032">go_fish.cuh:32</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_af2334ec2bc29ddb006030fc52f84e2cb"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af2334ec2bc29ddb006030fc52f84e2cb">GO_Fish::allele_trajectories::sim_constants::seed2</a></div><div class="ttdeci">int seed2</div><div class="ttdoc">random number seed 2 of 2 </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00059">go_fish_data_struct.h:59</a></div></div>
<div class="ttc" id="struct_sim___model_1_1bool__off_html"><div class="ttname"><a href="struct_sim___model_1_1bool__off.html">Sim_Model::bool_off</a></div><div class="ttdoc">functor: turns sampling and preserving off (for every generation except the final one which is always...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00272">go_fish.cuh:272</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html">GO_Fish::allele_trajectories</a></div><div class="ttdoc">control and output data structure for GO_Fish simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00054">go_fish_data_struct.h:54</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_a3a5406282cfa4db45a72213bd5e50e65"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a3a5406282cfa4db45a72213bd5e50e65">GO_Fish::allele_trajectories::sim_constants::compact_interval</a></div><div class="ttdeci">int compact_interval</div><div class="ttdoc">how often to compact the simulation and remove fixed or lost mutations </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00065">go_fish_data_struct.h:65</a></div></div>
<div class="ttc" id="struct_sim___model_1_1demography__constant_html"><div class="ttname"><a href="struct_sim___model_1_1demography__constant.html">Sim_Model::demography_constant</a></div><div class="ttdoc">functor: single, constant population size (N individuals) across populations and over time ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00154">go_fish.cuh:154</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_affaa6a67d6590f1c9e99769adebf82a9"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#affaa6a67d6590f1c9e99769adebf82a9">GO_Fish::allele_trajectories::sim_constants::num_populations</a></div><div class="ttdeci">int num_populations</div><div class="ttdoc">number of populations in simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00062">go_fish_data_struct.h:62</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html_ad426e41a3fec6914e16390500889fd0d"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html#ad426e41a3fec6914e16390500889fd0d">GO_Fish::allele_trajectories::maximal_num_mutations</a></div><div class="ttdeci">int maximal_num_mutations()</div><div class="ttdoc">returns number of reported mutations in the final time sample (maximal number of stored mutations in ...</div><div class="ttdef"><b>Definition:</b> <a href="inline__go__fish__data__struct_8hpp_source.html#l00091">inline_go_fish_data_struct.hpp:91</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_af7380836c9189ecbfe50945a1e90ae85"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af7380836c9189ecbfe50945a1e90ae85">GO_Fish::allele_trajectories::sim_constants::seed1</a></div><div class="ttdeci">int seed1</div><div class="ttdoc">random number seed 1 of 2 </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00058">go_fish_data_struct.h:58</a></div></div>
<div class="ttc" id="struct_sim___model_1_1_f__mu__h__constant_html"><div class="ttname"><a href="struct_sim___model_1_1_f__mu__h__constant.html">Sim_Model::F_mu_h_constant</a></div><div class="ttdoc">functor: models parameter p as a constant across populations and over time </div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00101">go_fish.cuh:101</a></div></div>
<div class="ttc" id="struct_sim___model_1_1migration__constant__equal_html"><div class="ttname"><a href="struct_sim___model_1_1migration__constant__equal.html">Sim_Model::migration_constant_equal</a></div><div class="ttdoc">functor: migration flows at rate m from pop i to pop j =/= i and 1-(num_pop-1)*m for i == j ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00232">go_fish.cuh:232</a></div></div>
<div class="ttc" id="go__fish_8cuh_html"><div class="ttname"><a href="go__fish_8cuh.html">go_fish.cuh</a></div><div class="ttdoc">GO Fish Simulation API (contains namespaces GO_Fish and Sim_Model) </div></div>
<div class="ttc" id="namespace_g_o___fish_html_a7e11d273a799f6ddbda24e3115a49083"><div class="ttname"><a href="namespace_g_o___fish.html#a7e11d273a799f6ddbda24e3115a49083">GO_Fish::run_sim</a></div><div class="ttdeci">__host__ void run_sim(allele_trajectories &amp;all_results, const Functor_mutation mu_rate, const Functor_demography demography, const Functor_migration mig_prop, const Functor_selection sel_coeff, const Functor_inbreeding FI, const Functor_dominance dominance, const Functor_preserve preserve_mutations, const Functor_timesample take_sample)</div><div class="ttdoc">runs a single-locus Wright-Fisher simulation specified by the given simulation functions and sim_cons...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish__impl_8cuh_source.html#l00701">go_fish_impl.cuh:701</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_a1bfe24f3cfc8c2b1ca02a7e8f39d78ed"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a1bfe24f3cfc8c2b1ca02a7e8f39d78ed">GO_Fish::allele_trajectories::sim_constants::num_sites</a></div><div class="ttdeci">float num_sites</div><div class="ttdoc">number of sites in simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00061">go_fish_data_struct.h:61</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html_aeb34bc193f8493c481313a83163f931f"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">GO_Fish::allele_trajectories::sim_input_constants</a></div><div class="ttdeci">sim_constants sim_input_constants</div><div class="ttdoc">constants for initializing the next simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00072">go_fish_data_struct.h:72</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_a24c743e3051a7c443742436154e545b0"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a24c743e3051a7c443742436154e545b0">GO_Fish::allele_trajectories::sim_constants::num_generations</a></div><div class="ttdeci">int num_generations</div><div class="ttdoc">number of generations in simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00060">go_fish_data_struct.h:60</a></div></div>
</div><!-- fragment --><p> In the example makefile below, each line is documented by the top part of the makefile: <br />
<br />
 <b>Tip:</b> The makefile below compiles machine code explicitly for generation 3.0 and 5.2 GPUs and uses just in time (JIT) compilation for everything else (lowest GPU generation which works for 3P is 3.0). Compilation (and program execution) will be faster if compiling for <b>your specific GPU</b>. <br />
<br />
 e.g. if running a Tesla K20 or Tesla K40, <a href="https://developer.nvidia.com/cuda-gpus">then the corresponding GPU generation is 3.5</a>: all the current <code>--generate-code arch=##,code=##</code> flags can be deleted and replaced with <code>--generate-code arch=compute_35,code=sm_35</code>. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Description of Mac/Linux/Unix Makefile for example_speed. </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;#</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;#############################</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;# build_path := Where to build program and put executable (note: folder must already exist)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;# api_path_source := Location of API source folder</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;# api_path_include := Location of API include folder</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# EXEC_FILE := Name of executable </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;#</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;# NVCC := Compiler path, in this case nvcc is in $PATH</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;# CFLAGS := Compiler Flags: optimize most, fast math, add API include folder to include search path, equivalent to --compile</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;# CODE := GPU types for which to build explicitly (I have a NVIDIA GTX 780M and 980) https://developer.nvidia.com/cuda-gpus, creates machine code for code=sm_30 (780) and code=sm_52 (980) and virtual architectures for all other generations which can be compiled JIT - code=compute_30 for generations between (3.0,5.0) and code=compute_50 for generations (5.0 and up) http://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html#options-for-steering-gpu-code-generation</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;#</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;# object_names := Objects required for executable</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;# objects := Prepends build path to object names</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;#</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;# all := Command &#39;make&#39; or &#39;make all&#39; builds executable file $(EXEC_FILE) in location $(build_path)/</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;#</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;# ##### Object Dependencies Lists #####</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;# If one of the files on the right hand side of the : changes, the corresponding object must be recompiled.</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;# This version always forces a recompile of the objects.</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;# ##### End Object Dependencies Lists #####</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;#</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;# $(objects) := Make target all objects</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;#  Compile source code into objects, $&lt; := dependencies from Object Dependencies Lists, $@ := object in $(objects)</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;#</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;# $(build_path)/$(EXEC_FILE) := Make target executable EXEC_FILE which depends on all objects</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;#  Link objects into executable EXEC_FILE, $@ := $(build_path)/$(EXEC_FILE)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;#</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;# .PHONY := Defines &#39;all&#39; and &#39;clean&#39; as not true targets (i.e. don&#39;t remake executable if can&#39;t find files called &#39;all&#39; or &#39;clean&#39; or &#39;FORCE&#39;)</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;#</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;# clean := Action to perform for command &#39;make clean&#39;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;#  Remove all objects and EXEC_FILE from build_path</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;#</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;# FORCE := empty command designed to force the compiler to always recompile all objects upon make all</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;#############################</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;build_path = ../bin</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;api_path_source = ../../3P/_internal</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;api_path_include = ../../3P</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;EXEC_FILE = GOFish</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;NVCC = nvcc --std=c++11</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;CFLAGS = -O2 --use_fast_math -I $(api_path_include)/ -c</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;CODE = --generate-code arch=compute_30,code=sm_30 --generate-code arch=compute_52,code=sm_52 --generate-code arch=compute_30,code=compute_30 --generate-code arch=compute_50,code=compute_50</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;object_names = run.o </div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;objects = $(addprefix $(build_path)/,$(object_names))</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;all:$(build_path)/$(EXEC_FILE)</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;##### OBJECT DEPENDENCIES #####</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;$(build_path)/run.o: run.cu FORCE</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;##### END OBJECT DEPENDENCIES #####</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;$(objects):</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;   $(NVCC) $(CODE) $(CFLAGS) $&lt; -o $@ </div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;$(build_path)/$(EXEC_FILE): $(objects)</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   $(NVCC) $(CODE) $(objects) -o $@</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;.PHONY: all clean FORCE</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;clean:</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   rm -f $(objects) $(build_path)/$(EXEC_FILE)</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;   </div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;FORCE:</div></div><!-- fragment --><div class="fragment"></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
