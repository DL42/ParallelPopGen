<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Parallel PopGen Package: Example2-DaDi</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Parallel PopGen Package
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_example2-_da_di-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example2-DaDi</div>  </div>
</div><!--header-->
<div class="contents">
<p>Compares SFS generation using executable GOFish (<a class="el" href="namespace_g_o___fish.html" title="Namespace for single-locus, forward, Monte-Carlo Wright-Fisher simulation and output data structures...">GO_Fish</a> and <a class="el" href="namespace_spectrum.html" title="Namespace for site frequency spectrum data structure and functions. (in prototype-phase) ...">Spectrum</a>) against δaδi. <br />
<br />
 See subsection <a class="el" href="index.html#δaδi">δaδi-to-GOFish Parameter Conversion</a> in <a class="el" href="index.html">Getting Started</a> for how to translate parameters from δaδi to <a class="el" href="namespace_g_o___fish.html" title="Namespace for single-locus, forward, Monte-Carlo Wright-Fisher simulation and output data structures...">GO_Fish</a> in general. </p><div class="image">
<img src="demography.jpg" alt="demography.jpg"/>
<div class="caption">
Demography of population 0 (AF) and population 1 (EU)</div></div>
<p> A complex demographic scenario was chosen as a test case to compare the <a class="el" href="namespace_g_o___fish.html" title="Namespace for single-locus, forward, Monte-Carlo Wright-Fisher simulation and output data structures...">GO_Fish</a> simulation against an already established SFS method, δaδi. The demographic model is from the YRI-CEU (AF-EU) δaδi example. Using δaδi parameterization to describe the model, the ancestral population, in mutation-selection equilibrium, undergoes an immediate expansion from <em>N<sub>ref</sub></em> to 2<em>N<sub>ref</sub></em> individuals. After time <em>T1</em> (= 0.005) the population splits into two with a constant, equivalent migration, <em>m<sub>EU-AF</sub></em> (= 1) between the now split populations. The second (EU) population undergoes a severe bottleneck of 0.05<em>N<sub>ref</sub></em> when splitting from the first (AF) population, followed by exponential growth over time <em>T2</em> (= 0.045) to size 5<em>N<sub>ref</sub></em>. The mutations are weakly deleterious and co-dominant (2<em>N<sub>ref</sub>s</em> = -2, <em>h</em> =0.5), where 1001 samples were taken of the EU population. The spectrum was then normalized by the number of segregating sites. The corresponding GO Fish parameters for the evolutionary scenario, given a mutation rate of 1x10<sup>-9</sup> per site, 2x10<sup>9</sup> sites, and an initial population size, <em>N<sub>ref</sub></em>, of 10,000, are: <em>T1</em> = 0.005*2<em>N<sub>ref</sub></em> = 100 generations, <em>T2</em> = 900 generations, <em>m<sub>EU-AF</sub></em> = 1/(2<em>N<sub>ref</sub></em>) = 0.00005, 2<em>N<sub>ref</sub>s</em> = -4, <em>h</em> =0.5, and <em>F</em> = 0. As in δaδi, the population size/time can be scaled together and the simulation will generate the same normalized spectra. Below is the <a class="el" href="namespace_g_o___fish.html" title="Namespace for single-locus, forward, Monte-Carlo Wright-Fisher simulation and output data structures...">GO_Fish</a> simulation and <a class="el" href="namespace_spectrum.html" title="Namespace for site frequency spectrum data structure and functions. (in prototype-phase) ...">Spectrum</a> SFS code: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * run.cu</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *      Author: David Lawrie</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="go__fish_8cuh.html">go_fish.cuh</a>&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="spectrum_8h.html">spectrum.h</a>&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * population 0 starts of in mutation-selection equilibrium at size N_ind</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * population 0 grows to size 2*N_ind at generation 1</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * at generation 0.01*N_ind, population 1 splits off from population 0</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * population 1&#39;s initial size is 0.05*N_ind</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * population 1 grows exponentially to size 5*N_ind for 0.09*N_ind generations</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * migration between populations is at rate 1/(2*N_ind) starting at generation 0.01*N_ind+1</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * selection is weakly deleterious (gamma = -4), mutations are co-dominant (h = 0.5), populations are outbred (F = 0)</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keywordtype">void</span> run_validation_test(){</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//  cudaDeviceReset();</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keyword">typedef</span> <a name="_a0"></a><a class="code" href="struct_sim___model_1_1demography__constant.html">Sim_Model::demography_constant</a> dem_const;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keyword">typedef</span> <a name="_a1"></a><a class="code" href="struct_sim___model_1_1demography__population__specific.html">Sim_Model::demography_population_specific&lt;dem_const,dem_const&gt;</a> dem_pop_const;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keyword">typedef</span> <a name="_a2"></a><a class="code" href="struct_sim___model_1_1demography__piecewise.html">Sim_Model::demography_piecewise&lt;dem_pop_const,dem_pop_const&gt;</a> init_expansion;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">typedef</span> <a name="_a3"></a><a class="code" href="struct_sim___model_1_1demography__exponential__growth.html">Sim_Model::demography_exponential_growth</a> exp_growth;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="struct_sim___model_1_1demography__population__specific.html">Sim_Model::demography_population_specific&lt;dem_const,exp_growth&gt;</a> dem_pop_const_exp;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keyword">typedef</span> <a name="_a4"></a><a class="code" href="struct_sim___model_1_1migration__constant__equal.html">Sim_Model::migration_constant_equal</a> mig_const;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keyword">typedef</span> <a name="_a5"></a><a class="code" href="struct_sim___model_1_1migration__constant__directional.html">Sim_Model::migration_constant_directional&lt;mig_const&gt;</a> mig_dir;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="struct_sim___model_1_1migration__constant__directional.html">Sim_Model::migration_constant_directional&lt;mig_dir&gt;</a> mig_split;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keyword">typedef</span> <a name="_a6"></a><a class="code" href="struct_sim___model_1_1migration__piecewise.html">Sim_Model::migration_piecewise&lt;mig_const,mig_split&gt;</a> split_pop0;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordtype">float</span> scale_factor = 1.0f;                                          <span class="comment">//entire simulation can be scaled up or down with little to no change in resulting normalized SFS</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a name="_a7"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories.html">GO_Fish::allele_trajectories</a> b;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    b.<a name="a8"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a9"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#affaa6a67d6590f1c9e99769adebf82a9">num_populations</a> = 2;                          <span class="comment">//number of populations</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    b.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a10"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a24c743e3051a7c443742436154e545b0">num_generations</a> = 30;<span class="comment">//scale_factor*pow(10.f,3)+1;    //1,000 generations</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a name="_a11"></a><a class="code" href="struct_sim___model_1_1_f__mu__h__constant.html">Sim_Model::F_mu_h_constant</a> codominant(0.5f);                        <span class="comment">//dominance (co-dominant)</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="struct_sim___model_1_1_f__mu__h__constant.html">Sim_Model::F_mu_h_constant</a> outbred(0.f);                            <span class="comment">//inbreeding (outbred)</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="struct_sim___model_1_1_f__mu__h__constant.html">Sim_Model::F_mu_h_constant</a> mutation(pow(10.f,-9)/scale_factor);     <span class="comment">//per-site mutation rate 10^-9</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordtype">int</span> N_ind = scale_factor*pow(10.f,4);                               <span class="comment">//initial number of individuals in population</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    dem_const pop0(N_ind);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    dem_const pop1(0);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    dem_pop_const gen0(pop0,pop1,1);                                    <span class="comment">//intial population size of N_ind for pop 0 and 0 for pop 1</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    dem_const pop0_final(2*N_ind);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    dem_pop_const gen1(pop0_final,pop1,1);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    init_expansion gen_0_1(gen0,gen1,1);                                <span class="comment">//population 0 grows to size 2*N_ind</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    exp_growth pop1_gen100((log(100.f)/(scale_factor*900.f)),0.05*N_ind,scale_factor*100);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    dem_pop_const_exp gen100(pop0_final,pop1_gen100,1);                 <span class="comment">//population 1 grows exponentially from size 0.05*N_ind to 5*N_ind</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="struct_sim___model_1_1demography__piecewise.html">Sim_Model::demography_piecewise&lt;init_expansion,dem_pop_const_exp&gt;</a> demography_model(gen_0_1,gen100,scale_factor*100);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    mig_const no_mig_pop0;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    mig_dir no_pop1_gen0(0.f,1,1,no_mig_pop0);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    mig_split create_pop1(1.f,0,1,no_pop1_gen0);                        <span class="comment">//individuals from population 0 migrate to form population 1</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    split_pop0 migration_split(no_mig_pop0,create_pop1,scale_factor*100);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordtype">float</span> mig = 1.f/(2.f*N_ind);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    mig_const mig_prop(mig,b.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#affaa6a67d6590f1c9e99769adebf82a9">num_populations</a>);      <span class="comment">//constant and equal migration between populations</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="struct_sim___model_1_1migration__piecewise.html">Sim_Model::migration_piecewise&lt;split_pop0,mig_const&gt;</a> mig_model(migration_split,mig_prop,scale_factor*100+1);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">float</span> gamma = -4;                                                   <span class="comment">//effective selection</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a name="_a12"></a><a class="code" href="struct_sim___model_1_1selection__constant.html">Sim_Model::selection_constant</a> weak_del(gamma,demography_model,outbred);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    b.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a13"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a3a5406282cfa4db45a72213bd5e50e65">compact_interval</a> = 30;                        <span class="comment">//compact interval</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    b.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a14"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a1bfe24f3cfc8c2b1ca02a7e8f39d78ed">num_sites</a> = 100*2*pow(10.f,7);                <span class="comment">//number of sites</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">int</span> sample_size = 1001;                                             <span class="comment">//number of samples in SFS</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">int</span> num_iter = 1;                                                   <span class="comment">//number of iterations</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a name="_a15"></a><a class="code" href="struct_spectrum_1_1_s_f_s.html">Spectrum::SFS</a> my_spectra;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">//cudaEvent_t start, stop;                                          //CUDA timing functions</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">//float elapsedTime;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">//cudaEventCreate(&amp;start);</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">//cudaEventCreate(&amp;stop);</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordtype">float</span> avg_num_mutations = 0;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordtype">float</span> avg_num_mutations_sim = 0;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    std::vector&lt;std::vector&lt;float&gt; &gt; results(num_iter);                 <span class="comment">//storage for SFS results</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; num_iter; j++){ results[j].reserve(sample_size); }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; num_iter; j++){</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="comment">//if(j == num_iter/2){ cudaEventRecord(start, 0); }                 //use 2nd half of the simulations to time simulation runs + SFS creation</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        b.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a16"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af7380836c9189ecbfe50945a1e90ae85">seed1</a> = 0xbeeff00d + 2*j;                 <span class="comment">//random number seeds</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        b.<a class="code" href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">sim_input_constants</a>.<a name="a17"></a><a class="code" href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af2334ec2bc29ddb006030fc52f84e2cb">seed2</a> = 0xdecafbad - 2*j;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <a name="a18"></a><a class="code" href="namespace_g_o___fish.html#a7e11d273a799f6ddbda24e3115a49083">GO_Fish::run_sim</a>(b, mutation, demography_model, mig_model, weak_del, outbred, codominant, <a name="_a19"></a><a class="code" href="struct_sim___model_1_1bool__off.html">Sim_Model::bool_off</a>(), <a class="code" href="struct_sim___model_1_1bool__off.html">Sim_Model::bool_off</a>());</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">//      Spectrum::site_frequency_spectrum(my_spectra,b,0,1,sample_size);</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">//      avg_num_mutations += ((float)my_spectra.num_mutations)/num_iter;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">//      avg_num_mutations_sim += b.maximal_num_mutations()/num_iter;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">//      for(int i = 0; i &lt; sample_size; i++){ results[j][i] = my_spectra.frequency_spectrum[i]; }</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">//      std::cout&lt;&lt;&quot;\n&quot;&lt;&lt;j&lt;&lt;&quot;\t&quot;&lt;&lt;b.maximal_num_mutations()&lt;&lt;&quot;\n&quot;;</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordflow">if</span>(j == 0){</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            std::ofstream outfile;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            outfile.open(<span class="stringliteral">&quot;bfile.dat&quot;</span>);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            outfile&lt;&lt;b;                                                 <span class="comment">//prints full allele_trajectory b to file</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            outfile.close();</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">//elapsedTime = 0;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">//cudaEventRecord(stop, 0);</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">//cudaEventSynchronize(stop);</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">//cudaEventElapsedTime(&amp;elapsedTime, start, stop);</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">//cudaEventDestroy(start);</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">//cudaEventDestroy(stop);</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">//output SFS simulation results</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">//  std::cout&lt;&lt;&quot;SFS :&quot;&lt;&lt;std::endl&lt;&lt; &quot;allele count\tavg# mutations\tstandard dev\tcoeff of variation (aka relative standard deviation)&quot;&lt;&lt; std::endl;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">//  for(int i = 1; i &lt; sample_size; i++){</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">//      double avg = 0;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">//      double std = 0;</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">//      float num_mutations;</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">//      for(int j = 0; j &lt; num_iter; j++){ num_mutations = b.num_sites() - results[j][0]; avg += results[j][i]/(num_iter*num_mutations); }</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">//      for(int j = 0; j &lt; num_iter; j++){ num_mutations = b.num_sites() - results[j][0]; std += 1.0/(num_iter-1)*pow(results[j][i]/num_mutations-avg,2); }</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">//      std = sqrt(std);</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">//      std::cout&lt;&lt;i&lt;&lt;&quot;\t&quot;&lt;&lt;avg&lt;&lt;&quot;\t&quot;&lt;&lt;std&lt;&lt;&quot;\t&quot;&lt;&lt;(std/avg)&lt;&lt;std::endl;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">//  }</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">//  std::cout&lt;&lt;&quot;\nnumber of sites in simulation: &quot;&lt;&lt; b.num_sites() &lt;&lt;&quot;\ncompact interval: &quot;&lt;&lt; b.last_run_constants().compact_interval;</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">//  std::cout&lt;&lt;&quot;\naverage number of mutations in simulation: &quot;&lt;&lt;avg_num_mutations_sim&lt;&lt;&quot;\naverage number of mutations in SFS: &quot;&lt;&lt;avg_num_mutations&lt;&lt;&quot;\ntime elapsed (ms): &quot;&lt;&lt; /*2*elapsedTime/num_iter&lt;&lt;*/std::endl;</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;}</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) { run_validation_test(); }</div><div class="ttc" id="struct_sim___model_1_1selection__constant_html"><div class="ttname"><a href="struct_sim___model_1_1selection__constant.html">Sim_Model::selection_constant</a></div><div class="ttdoc">functor: models selection coefficient s as a constant across populations and over time ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00032">go_fish.cuh:32</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_af2334ec2bc29ddb006030fc52f84e2cb"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af2334ec2bc29ddb006030fc52f84e2cb">GO_Fish::allele_trajectories::sim_constants::seed2</a></div><div class="ttdeci">int seed2</div><div class="ttdoc">random number seed 2 of 2 </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00059">go_fish_data_struct.h:59</a></div></div>
<div class="ttc" id="struct_sim___model_1_1migration__piecewise_html"><div class="ttname"><a href="struct_sim___model_1_1migration__piecewise.html">Sim_Model::migration_piecewise</a></div><div class="ttdoc">functor: migration function changes from m1 to m2 at generation inflection_point </div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00256">go_fish.cuh:256</a></div></div>
<div class="ttc" id="struct_sim___model_1_1bool__off_html"><div class="ttname"><a href="struct_sim___model_1_1bool__off.html">Sim_Model::bool_off</a></div><div class="ttdoc">functor: turns sampling and preserving off (for every generation except the final one which is always...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00272">go_fish.cuh:272</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html">GO_Fish::allele_trajectories</a></div><div class="ttdoc">control and output data structure for GO_Fish simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00054">go_fish_data_struct.h:54</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_a3a5406282cfa4db45a72213bd5e50e65"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a3a5406282cfa4db45a72213bd5e50e65">GO_Fish::allele_trajectories::sim_constants::compact_interval</a></div><div class="ttdeci">int compact_interval</div><div class="ttdoc">how often to compact the simulation and remove fixed or lost mutations </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00065">go_fish_data_struct.h:65</a></div></div>
<div class="ttc" id="struct_sim___model_1_1demography__constant_html"><div class="ttname"><a href="struct_sim___model_1_1demography__constant.html">Sim_Model::demography_constant</a></div><div class="ttdoc">functor: single, constant population size (N individuals) across populations and over time ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00154">go_fish.cuh:154</a></div></div>
<div class="ttc" id="struct_sim___model_1_1migration__constant__directional_html"><div class="ttname"><a href="struct_sim___model_1_1migration__constant__directional.html">Sim_Model::migration_constant_directional</a></div><div class="ttdoc">functor: migration flows at rate m from pop1 to pop2 and function rest for all other migration rates ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00243">go_fish.cuh:243</a></div></div>
<div class="ttc" id="struct_spectrum_1_1_s_f_s_html"><div class="ttname"><a href="struct_spectrum_1_1_s_f_s.html">Spectrum::SFS</a></div><div class="ttdoc">site frequency spectrum data structure (at the moment, functions only generate SFS for a single popul...</div><div class="ttdef"><b>Definition:</b> <a href="spectrum_8h_source.html#l00024">spectrum.h:24</a></div></div>
<div class="ttc" id="struct_sim___model_1_1demography__population__specific_html"><div class="ttname"><a href="struct_sim___model_1_1demography__population__specific.html">Sim_Model::demography_population_specific</a></div><div class="ttdoc">functor: one population, pop, has a different, demography function, d_pop, all others have function...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00203">go_fish.cuh:203</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_affaa6a67d6590f1c9e99769adebf82a9"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#affaa6a67d6590f1c9e99769adebf82a9">GO_Fish::allele_trajectories::sim_constants::num_populations</a></div><div class="ttdeci">int num_populations</div><div class="ttdoc">number of populations in simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00062">go_fish_data_struct.h:62</a></div></div>
<div class="ttc" id="spectrum_8h_html"><div class="ttname"><a href="spectrum_8h.html">spectrum.h</a></div><div class="ttdoc">proto-API for building site frequency spectra (contains the titular namespace Spectrum) ...</div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_af7380836c9189ecbfe50945a1e90ae85"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#af7380836c9189ecbfe50945a1e90ae85">GO_Fish::allele_trajectories::sim_constants::seed1</a></div><div class="ttdeci">int seed1</div><div class="ttdoc">random number seed 1 of 2 </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00058">go_fish_data_struct.h:58</a></div></div>
<div class="ttc" id="struct_sim___model_1_1_f__mu__h__constant_html"><div class="ttname"><a href="struct_sim___model_1_1_f__mu__h__constant.html">Sim_Model::F_mu_h_constant</a></div><div class="ttdoc">functor: models parameter p as a constant across populations and over time </div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00101">go_fish.cuh:101</a></div></div>
<div class="ttc" id="struct_sim___model_1_1migration__constant__equal_html"><div class="ttname"><a href="struct_sim___model_1_1migration__constant__equal.html">Sim_Model::migration_constant_equal</a></div><div class="ttdoc">functor: migration flows at rate m from pop i to pop j =/= i and 1-(num_pop-1)*m for i == j ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00232">go_fish.cuh:232</a></div></div>
<div class="ttc" id="go__fish_8cuh_html"><div class="ttname"><a href="go__fish_8cuh.html">go_fish.cuh</a></div><div class="ttdoc">GO Fish Simulation API (contains namespaces GO_Fish and Sim_Model) </div></div>
<div class="ttc" id="struct_sim___model_1_1demography__exponential__growth_html"><div class="ttname"><a href="struct_sim___model_1_1demography__exponential__growth.html">Sim_Model::demography_exponential_growth</a></div><div class="ttdoc">functor: models exponential growth of population size (individuals) over time </div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00177">go_fish.cuh:177</a></div></div>
<div class="ttc" id="namespace_g_o___fish_html_a7e11d273a799f6ddbda24e3115a49083"><div class="ttname"><a href="namespace_g_o___fish.html#a7e11d273a799f6ddbda24e3115a49083">GO_Fish::run_sim</a></div><div class="ttdeci">__host__ void run_sim(allele_trajectories &amp;all_results, const Functor_mutation mu_rate, const Functor_demography demography, const Functor_migration mig_prop, const Functor_selection sel_coeff, const Functor_inbreeding FI, const Functor_dominance dominance, const Functor_preserve preserve_mutations, const Functor_timesample take_sample)</div><div class="ttdoc">runs a single-locus Wright-Fisher simulation specified by the given simulation functions and sim_cons...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish__impl_8cuh_source.html#l00701">go_fish_impl.cuh:701</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_a1bfe24f3cfc8c2b1ca02a7e8f39d78ed"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a1bfe24f3cfc8c2b1ca02a7e8f39d78ed">GO_Fish::allele_trajectories::sim_constants::num_sites</a></div><div class="ttdeci">float num_sites</div><div class="ttdoc">number of sites in simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00061">go_fish_data_struct.h:61</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_html_aeb34bc193f8493c481313a83163f931f"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories.html#aeb34bc193f8493c481313a83163f931f">GO_Fish::allele_trajectories::sim_input_constants</a></div><div class="ttdeci">sim_constants sim_input_constants</div><div class="ttdoc">constants for initializing the next simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00072">go_fish_data_struct.h:72</a></div></div>
<div class="ttc" id="struct_sim___model_1_1demography__piecewise_html"><div class="ttname"><a href="struct_sim___model_1_1demography__piecewise.html">Sim_Model::demography_piecewise</a></div><div class="ttdoc">functor: demography function changes from d1 to d2 at generation inflection_point ...</div><div class="ttdef"><b>Definition:</b> <a href="go__fish_8cuh_source.html#l00216">go_fish.cuh:216</a></div></div>
<div class="ttc" id="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants_html_a24c743e3051a7c443742436154e545b0"><div class="ttname"><a href="struct_g_o___fish_1_1allele__trajectories_1_1sim__constants.html#a24c743e3051a7c443742436154e545b0">GO_Fish::allele_trajectories::sim_constants::num_generations</a></div><div class="ttdeci">int num_generations</div><div class="ttdoc">number of generations in simulation </div><div class="ttdef"><b>Definition:</b> <a href="go__fish__data__struct_8h_source.html#l00060">go_fish_data_struct.h:60</a></div></div>
</div><!-- fragment --><p> Below is the corresponding δaδi code: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;import time</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> numpy</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">from</span> numpy <span class="keyword">import</span> array</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">import</span> dadi</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">def </span>prior_onegrow_mig((nu1F, nu2B, nu2F, m, Tp, T), (n1,n2), pts):</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="stringliteral">    Model with growth, split, bottleneck in pop2, exp recovery, migration</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="stringliteral">    nu1F: The ancestral population size after growth. (Its initial size is</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="stringliteral">          defined to be 1.)</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="stringliteral">    nu2B: The bottleneck size for pop2</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="stringliteral">    nu2F: The final size for pop2</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="stringliteral">    m: The scaled migration rate</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="stringliteral">    Tp: The scaled time between ancestral population growth and the split.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="stringliteral">    T: The time between the split and present</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="stringliteral">    n1,n2: Size of fs to generate.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="stringliteral">    pts: Number of points to use in grid for evaluation.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="comment"># Define the grid we&#39;ll use</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    xx = yy = dadi.Numerics.default_grid(pts)</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    gamma_model = -2;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="comment"># phi for the equilibrium ancestral population</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    phi = dadi.PhiManip.phi_1D(xx, gamma=gamma_model)</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment"># Now do the population growth event.</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    phi = dadi.Integration.one_pop(phi, xx, Tp, nu=nu1F, gamma=gamma_model)</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment"># The divergence</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    phi = dadi.PhiManip.phi_1D_to_2D(xx, phi)</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment"># We need to define a function to describe the non-constant population 2</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment"># size. lambda is a convenient way to do so.</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    nu2_func = <span class="keyword">lambda</span> t: nu2B*(nu2F/nu2B)**(t/T)</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    phi = dadi.Integration.two_pops(phi, xx, T, nu1=nu1F, nu2=nu2_func, m12=m, m21=m, gamma1=gamma_model, gamma2=gamma_model)</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment"># Finally, calculate the spectrum.</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    sfs = dadi.Spectrum.from_phi(phi, (n1,n2), (xx,yy))</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">return</span> sfs</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keyword">def </span>runModel(nu1F, nu2B, nu2F, m, Tp, T):</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    ns = (0,1001)</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">print</span> <span class="stringliteral">&#39;sample sizes:&#39;</span>, ns</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment"># These are the grid point settings will use for extrapolation.</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    pts_l = [110,120,130]</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    func = prior_onegrow_mig</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    params = array([nu1F, nu2B, nu2F, m, Tp, T])</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment"># Make the extrapolating version of the demographic model function.</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    func_ex = dadi.Numerics.make_extrap_func(func)</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment"># Calculate the model AFS.</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    model = func_ex(params, ns, pts_l)</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    model = model.marginalize((0,))</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">return</span> model</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    </div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;time1 = time.time()</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;model = runModel(2, 0.05, 5, 1, 0.005, 0.045)</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;time2 = time.time()</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keywordflow">print</span> <span class="stringliteral">&quot;total runtime (s): &quot;</span> + str(time2-time1)</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;model = model/model.S()</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(0,len(model)):</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">print</span> model[i]</div></div><!-- fragment --><p> Below is the makefile to create executable GOFish from examples/example_dadi/run.cu, each line is documented by the top part of the makefile: <br />
<br />
 <b>Tip:</b> The makefile below compiles machine code explicitly for generation 3.0 and 5.2 GPUs and uses just in time (JIT) compilation for everything else (lowest GPU generation which works for 3P is 3.0). Compilation (and program execution) will be faster if compiling for <b>your specific GPU</b>. <br />
<br />
 e.g. if running a Tesla K20 or Tesla K40, <a href="https://developer.nvidia.com/cuda-gpus">then the corresponding GPU generation is 3.5</a>: all the current <code>--generate-code arch=##,code=##</code> flags can be deleted and replaced with <code>--generate-code arch=compute_35,code=sm_35</code>. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Description of Mac/Linux/Unix Makefile for example_dadi. </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;#</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;#############################</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;# build_path := Where to build program and put executable (note: folder must already exist)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;# api_path_source := Location of API source folder</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;# api_path_include := Location of API include folder</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# EXEC_FILE := Name of executable </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;#</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;# NVCC := Compiler path, in this case nvcc is in $PATH</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;# CFLAGS := Compiler Flags: optimize most, fast math, add API include folder to include search path, equivalent to --relocatable-device-code=true --compile</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;# CODE := GPU types for which to build explicitly (I have a NVIDIA GTX 780M and 980) https://developer.nvidia.com/cuda-gpus, creates machine code for code=sm_30 (780) and code=sm_52 (980) and virtual architectures for all other generations which can be compiled JIT - code=compute_30 for generations between (3.0,5.0) and code=compute_50 for generations (5.0 and up) http://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html#options-for-steering-gpu-code-generation</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;#</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;# object_names := Objects required for executable</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;# objects := Prepends build path to object names</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;#</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;# all := Command &#39;make&#39; or &#39;make all&#39; builds executable file $(EXEC_FILE) in location $(build_path)/</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;#</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;# ##### Object Dependencies Lists #####</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;# If one of the files on the right hand side of the : changes, the corresponding object must be recompiled.</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;# This is a developer&#39;s makefile - it assumes there will be changes to the GOFish API files, if not</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;# all the non-*.cu (non source file) dependencies are unnecessary.</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;# ##### End Object Dependencies Lists #####</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;#</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;# $(objects) := Make target all objects</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;#  Compile source code into objects, $&lt; := dependencies from Object Dependencies Lists, $@ := object in $(objects)</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;#</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;# $(build_path)/$(EXEC_FILE) := Make target executable EXEC_FILE which depends on all objects</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;#  Link objects into executable EXEC_FILE, $@ := $(build_path)/$(EXEC_FILE)</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;#</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;# .PHONY := Defines &#39;all&#39; and &#39;clean&#39; as not true targets (i.e. don&#39;t remake executable if can&#39;t find files called &#39;all&#39; or &#39;clean&#39;)</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;#</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;# clean := Action to perform for command &#39;make clean&#39;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;#  Remove all objects and EXEC_FILE from build_path</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;#############################</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;build_path = ../bin</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;api_path_source = ../../3P/_internal</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;api_path_include = ../../3P</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;EXEC_FILE = GOFish</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;NVCC = nvcc -std=c++11</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;CFLAGS = -O3 --use_fast_math -I $(api_path_include)/ -dc</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;CODE = --generate-code arch=compute_30,code=sm_30 --generate-code arch=compute_52,code=sm_52 --generate-code arch=compute_30,code=compute_30 --generate-code arch=compute_52,code=compute_52</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;object_names = run.o spectrum.o</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;objects = $(addprefix $(build_path)/,$(object_names))</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;all:$(build_path)/$(EXEC_FILE)</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;##### OBJECT DEPENDENCIES #####</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;$(build_path)/run.o: run.cu $(api_path_source)/rng.cuh $(api_path_source)/cuda_helper_fun.cuh $(api_path_source)/go_fish_impl.cuh $(api_path_include)/go_fish_data_struct.h $(api_path_include)/go_fish.cuh $(api_path_include)/spectrum.h</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;$(build_path)/spectrum.o: $(api_path_source)/spectrum.cu $(api_path_include)/spectrum.h $(api_path_source)/cuda_helper_fun.cuh $(api_path_include)/go_fish_data_struct.h</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;##### END OBJECT DEPENDENCIES #####</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;$(objects):</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;   $(NVCC) $(CODE) $(CFLAGS) $&lt; -o $@</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;$(build_path)/$(EXEC_FILE): $(objects)</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   $(NVCC) $(CODE) $(objects) -o $@</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;.PHONY: all clean</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;clean:</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   rm -f $(objects) $(build_path)/$(EXEC_FILE)</div></div><!-- fragment --><div class="fragment"></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
